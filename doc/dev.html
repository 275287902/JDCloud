<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<link rel="Stylesheet" type="text/css" href="style.css">
<title>开发环境搭建</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>

<h1 id="toc_1" class="justcenter"><a name="开发环境搭建"> 开发环境搭建</a></h1>
 
<p>
梁健 - 最近更新于2015/7
</p>

<div class="toc">
<ul>
<li><a href="#toc_1"> 开发环境搭建</a>
<ul>
<li><a href="#toc_1.1">1 Windows开发环境</a>
<ul>
<li><a href="#toc_1.1.1">1.1 版本控制软件Git</a>
<li><a href="#toc_1.1.2">1.2 服务器环境PHP</a>
<li><a href="#toc_1.1.3">1.3 数据库MYSQL</a>
<li><a href="#toc_1.1.4">1.4 浏览器及移动设备</a>
<li><a href="#toc_1.1.5">1.5 编辑器</a>
</ul>
<li><a href="#toc_1.2">2 测试环境</a>
<ul>
<li><a href="#toc_1.2.1">2.1 安装perl</a>
<li><a href="#toc_1.2.2">2.2 php单元测试工具phpunit</a>
<li><a href="#toc_1.2.3">2.3 安装前端自动化测试环境</a>
</ul>
<li><a href="#toc_1.3">3 运行环境</a>
<ul>
<li><a href="#toc_1.3.1">3.1 下载代码</a>
<li><a href="#toc_1.3.2">3.2 运行服务</a>
<li><a href="#toc_1.3.3">3.3 主要页面</a>
</ul>
<li><a href="#toc_1.4">4 开发流程</a>
<li><a href="#toc_1.5">5 测试与部署环境</a>
<li><a href="#toc_1.6">6 附注</a>
</ul>
</ul>
</div>

<p>
服务器共享软件的路径为 <code>\\server-pc\share\Software</code>, 请将以下<code>{SHARE_SVR}</code>替换成该地址。
</p>

<h2 id="toc_1.1"><a name="Windows开发环境">1 Windows开发环境</a></h2>

<h3 id="toc_1.1.1"><a name="版本控制软件Git">1.1 版本控制软件Git</a></h3>

<p>
安装git：
</p>
<pre>
{SHARE_SVR}\Git\Git-1.9.5-preview20150319.exe
{SHARE_SVR}\Git\TortoiseGit-1.8.14.0-64bit.msi
</pre>

<p>
浏览器右键点菜单 TortoiseGit-&gt;Settings-&gt;(左边菜单树中选择)Git-&gt;设置 Name 和 Email, 如
Name: liangjian
Email: liangjian@oliveche.com
</p>

<p>
在 Settings-&gt;Network 中，确认右侧 SSH Client 使用的是刚刚安装的Git中的ssh路径，如
</p>
<pre>
C:\Program Files (x86)\Git\bin\ssh.exe
</pre>

<p>
如果代码服务器不提供用户名密码登录，那么需要设置ssh证书登录方式：
</p>

<p>
在用户主目录下(开始-&gt;运行-&gt;输入 "." 或 "%userprofile%")创建目录".ssh", 将 <code>${SHARE_SVR}\server-pc-key</code> 目录下的文件(config, id_rsa等)拷贝到".ssh"目录中。
如果目前下已经有同名文件，请手工修改和合并。
</p>

<p>
在文件夹空白处点右键，打开 Git Bash，尝试 ssh 是否可以自动登录到代码服务器。
</p>

<h3 id="toc_1.1.2"><a name="服务器环境PHP">1.2 服务器环境PHP</a></h3>

<ul>
<li>
安装php 5.4
<pre>
解压 {SHARE_SVR}\php-5.4.31-nts-Win32-VC9-x86-xdebug.zip 到 c:\php54
</pre>

<li>
将解压路径如 c:\php54 加到系统环境变量 PATH 中(参考附注1)，以便可以直接在命令行访问 php.

</ul>

<h3 id="toc_1.1.3"><a name="数据库MYSQL">1.3 数据库MYSQL</a></h3>

<p>
办公室环境可直接使用配置好的数据库服务器。
</p>

<p>
为直接访问数据库，可以安装数据库客户端：
</p>
<pre>
{SHARE_SVR}\MYSQL\MySQL_Front_Setup_v5.3.1765185107.exe
</pre>

<h3 id="toc_1.1.4"><a name="浏览器及移动设备">1.4 浏览器及移动设备</a></h3>

<p>
建议开发时使用chrome浏览器；请从网上下载并安装其最新版本。
</p>

<p>
主要测试环境包括：
</p>
<ul>
<li>
安卓手机/平板

<li>
苹果手机

<li>
微信公众号

</ul>

<h3 id="toc_1.1.5"><a name="编辑器">1.5 编辑器</a></h3>

<p>
建议安装上gvim编辑器。很多代码和文档(使用vimwiki格式)都使用gvim编写.
</p>

<pre>
{SHARE_SVR}\vim\gvim74.exe
</pre>

<p>
建议安装到 <code>c:\vim</code>
安装完成后将 <code>{SHARE_SVR}\vim\_vimrc</code> 拷贝到安装目录， 如<code>c:\vim</code>
</p>

<p>
安装vimwiki, 用于查看和书写文档.
</p>
<ul>
<li>
将{SHARE_SVR}\vim\vimwiki-lj-1.vmb拷贝到本地, 右键用gvim打开

<li>
运行安装命令
<pre>
:so! %
</pre>

</ul>

<p>
安装后查看文档(如doc/*.wiki文件)就有颜色、折叠、生成html网页文档等功能。
</p>

<h2 id="toc_1.2"><a name="测试环境">2 测试环境</a></h2>

<p>
前提: 先配置好Windows开发环境(git/php等).
</p>

<h3 id="toc_1.2.1"><a name="安装perl">2.1 安装perl</a></h3>

<p>
某些工具使用perl开发，所以应安装perl运行环境。
</p>
<pre>
{SHARE_SVR}\ActivePerl-5.16.3.1604-MSWin32-x86-298023.msi
</pre>

<h3 id="toc_1.2.2"><a name="php单元测试工具phpunit">2.2 php单元测试工具phpunit</a></h3>

<p>
phpunit可用于对php服务端提供的接口进行测试.
</p>

<p>
安装 phpunit
</p>
<ul>
<li>
新建目录 c:\bat 用于放置自已创建的批处理文件。将该目录c:\bat加到PATH环境变量（参考附注1）。

<li>
解压 <code>{SHARE_SVR}\php\phpunit.rar</code> 到c:\bat目录下，得到 c:\bat\phpunit.phar 文件

<li>
新建 phpunit.bat 文件，内容如下：
<pre>
@echo off
php c:/bat/phpunit.phar %*
</pre>

</ul>

<p>
这时，打开一个cmd窗口，应该可以直接运行phpunit命令：
</p>
<pre>
phpunit
</pre>

<p>
具体用法请参考文档<a href="后端框架.html">后端框架</a> 章节"测试设计" -&gt; "回归测试".
</p>

<h3 id="toc_1.2.3"><a name="安装前端自动化测试环境">2.3 安装前端自动化测试环境</a></h3>

<p>
<span class="todo">TODO:</span> 主要软件：nunit, selenium, firefox浏览器, VS.net (C#)
</p>

<p>
参考文档<a href="测试设计.html">测试设计</a>。
</p>

<h2 id="toc_1.3"><a name="运行环境">3 运行环境</a></h2>

<h3 id="toc_1.3.1"><a name="下载代码">3.1 下载代码</a></h3>

<p>
主要代码库：
<dl>
<dt>xeyc-sys</dt>
<dd>小鳄养车网上业务系统（含后台/前台），其中子目录<code>server</code>对应线上路径 <a href="http://xiaoeyangche.com/sys/</dd>">http://xiaoeyangche.com/sys/</dd></a>
<dt>xeyc-xdk</dt>
<dd>小鳄养车Android平台（使用xdk直接包装网页）</dd>
</dl>
xeyc-ios: 小鳄养车iOS客户端
xeyc-site: 小鳄养车网站主页, 对应线上 <a href="http://xiaoeyangche.com/site/">http://xiaoeyangche.com/site/</a> 
xeyc-test: 小鳄养车测试用例及回归测试代码
</p>

<pre>
git clone builder@server-pc:xeyc-sys
</pre>
<p>
可以在浏览器中右键选择Git Clone, 然后输入地址：<code>builder@server-pc:xeyc-sys</code>
</p>

<p>
密码: builder
</p>

<p>
注意: 
</p>
<ul>
<li>
如果要在办公室外访问代码库，可以用 <code>ssh://builder@oliveche.com:10022/home/builder/xeyc-sys</code>

</ul>

<h3 id="toc_1.3.2"><a name="运行服务">3.2 运行服务</a></h3>

<pre>
cd {cheguanjia}\server
set P_DB=server-pc/carsvc_test
php -S 0.0.0.0:8080
</pre>

<p>
如果<code>server-pc</code>访问慢，请换成IP地址或在/etc/hosts/文件中指定地址-机器名映射。
</p>

<p>
文件C:\Windows\System32\drivers\etc\hosts，添加
</p>
<pre>
192.168.3.135	server-pc
</pre>

<h3 id="toc_1.3.3"><a name="主要页面">3.3 主要页面</a></h3>

<p>
<strong>[网页客户端]</strong>
</p>

<p>
<a href="http://localhost:8080/">http://localhost:8080/</a>
或
<a href="http://localhost:8080/m2/index.html">http://localhost:8080/m2/index.html</a>
</p>

<p>
<strong>[员工端]</strong>
</p>

<p>
（自营商户员工接单）：
<a href="http://localhost:8080/m2/index.html">http://localhost:8080/m2/index.html</a>
</p>

<p>
<strong>[商户端]</strong>
</p>

<p>
<a href="http://localhost:8080/m2/store.html">http://localhost:8080/m2/store.html</a>
</p>

<p>
<strong>[商户管理端]</strong>
</p>

<p>
<a href="http://localhost:8080/web/store.html">http://localhost:8080/web/store.html</a>
</p>

<p>
<strong>[超级管理端]</strong>
</p>

<p>
<a href="http://localhost:8080/web/adm.html">http://localhost:8080/web/adm.html</a>
</p>

<h2 id="toc_1.4"><a name="开发流程">4 开发流程</a></h2>

<p>
<strong>[概念]</strong>
</p>

<dl>
<dt>开发周期</dt>
<dd>从开发部门确定下个版本开发计划到提交该版本产品截止。代码从主分支合并到发布分支意味着上一周期结束和下一周期开始。</dd>
<dt>产品周期（版本周期）</dt>
<dd>某产品版本上线，意味着上一周期结束和下一周期开始。</dd>
</dl>

<p>
<strong>[人员分工]</strong>
</p>

<ul>
<li>
开发

<li>
测试

<li>
发布

</ul>

<p>
<strong>[开发流程]</strong>
</p>

<p>
<a href="开发流程.xlsx.html">开发流程.xlsx</a>
</p>

<ul>
<li>
开发截止日

<li>
版本发布日

</ul>

<h2 id="toc_1.5"><a name="测试与部署环境">5 测试与部署环境</a></h2>

<p>
<strong>[内部服务器-测试服务]</strong>
</p>

<p>
数据库
</p>
<pre>
server-pc/carsvc_test
</pre>

<p>
对应的服务基址是
</p>

<pre>
SVC_URL=http://server-pc:8080/cheguanjia
</pre>

<ul>
<li>
开发人员应使用该数据库进行开发；

<li>
测试人员在开发周期截止前使用该服务地址。

</ul>

<p>
<strong>[内部服务器-正式服务]</strong>
</p>

<p>
数据库
</p>
<pre>
server-pc/carsvc
</pre>

<p>
对应的服务基址是
</p>

<pre>
SVC_URL=http://server-pc/cheguanjia
</pre>

<ul>
<li>
上线前（开发周期截止后）测试人员使用该服务地址进行测试。

</ul>

<p>
<strong>[线上服务器-测试服务]</strong>
</p>

<p>
数据库
</p>
<pre>
oliveche.com/carsvc_test
</pre>

<p>
对应的服务基址和正式服务相同，但需要在URL最后加参数"?test"，如
</p>

<pre>
SVC_URL=http://oliveche.com/cheguanjia/m2/index.html?test
</pre>

<ul>
<li>
上线后（产品周期开始后）测试人员使用该服务地址进行自动化回归测试。

</ul>

<p>
<strong>[线上服务器-正式服务]</strong>
</p>

<p>
数据库
</p>
<pre>
oliveche.com/carsvc
</pre>

<p>
对应的服务基址是
</p>

<pre>
SVC_URL=http://oliveche.com/cheguanjia
</pre>


<h2 id="toc_1.6"><a name="附注">6 附注</a></h2>

<p>
<strong>1. 添加新目录到PATH环境变量</strong>
</p>

<p>
按windows-break键 -&gt; 打开"高级系统设置" -&gt; 选择"高级"选项卡 -&gt; 点击按钮"环境变量" -&gt; 在用户变量中找"PATH"变量（如果不存在则新建一个），在变量值的最后添加该目录. 注意多个目录使用分号";"间隔。
</p>

<p>
如仍不清楚请上网查询。
</p>

</body>
</html>
